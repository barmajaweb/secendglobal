<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vira Décoration</title>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    .btn-secondary {
            background-color: var(--light);
            color: #C9A349;
            border: 1px solid var(--gray);
        }
       #toggleBtn {
  padding: 0.2rem 0.5rem;
  margin-left: 5%;
  border: 5px solid #C9A349;
  cursor: pointer;
  border-radius: 18px;
  width: 20px;
  font-weight: bolder;
  margin-top: 10px;
  background-color:#C9A349;
  color:white ;
  font-size: 10px;
  transition: 0.7s;
  padding-right: 3%;
}
#toggleBtn:hover {
  transform: scale(1.05);
}
.plateforme span {
  color:#C9A349 ;
  font-family: Arial, Helvetica, sans-serif;
  font-weight: bolder;
  font-size: 20px;
}
    :root {
            --primary: #004d40;
            --secondary: #00695c;
            --accent: #26a69a;
            --bg-main: #f5f7fa;
            --card-bg: #ffffff;
            --text-primary: #263238;
            --text-secondary: #546e7a;
            --radius: 16px;
            --shadow: 0 10px 40px rgba(0, 77, 64, 0.15);
            --glass: rgba(255, 255, 255, 0.9);
        }

     .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 77, 64, 0.7);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1300;
            padding: 20px;
        }

        .overlay.show {
            display: flex;
        }

        /* Modal Container */
        .contact-modal {
            width: 100%;
            max-width: 900px;
            border-radius: var(--radius);
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 0;
            background: var(--glass);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow);
            overflow: hidden;
            transform: translateY(-30px) scale(0.9);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .overlay.show .contact-modal {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        /* Left Section - Contact Details */
       .contact-left {
            padding: 40px 35px;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 500px;
            position: relative;
            max-height: 100vh; 
            overflow-y: auto;
        }

        /* Brand Section */
        .brand {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 30px;
        }

        .brand .logo {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 24px;
            box-shadow: 0 8px 25px rgba(0, 77, 64, 0.2);
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .brand .info .title {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .brand .info .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Contact List */
        .contact-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 30px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 18px;
            border-radius: 12px;
            background: linear-gradient(135deg, #f8fffe, #e8f5f4);
            border: 1px solid rgba(0, 77, 64, 0.1);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateX(20px);
            animation: slideInRight 0.6s ease forwards;
        }

        .contact-item:nth-child(1) { animation-delay: 0.1s; }
        .contact-item:nth-child(2) { animation-delay: 0.2s; }
        .contact-item:nth-child(3) { animation-delay: 0.3s; }
        .contact-item:nth-child(4) { animation-delay: 0.4s; }

        @keyframes slideInRight {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .contact-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 77, 64, 0.15);
            border-color: var(--accent);
        }

        .contact-item i {
            font-size: 20px;
            color: var(--primary);
            width: 32px;
            text-align: center;
        }

        .contact-item .meta {
            flex: 1;
            text-align: right;
        }

        .contact-item .meta .label {
            font-weight: 700;
            font-size: 14px;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .contact-item .meta .value {
            font-size: 15px;
            color: var(--text-secondary);
        }

        .contact-item .meta .value a {
            color: inherit;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .contact-item .meta .value a:hover {
            color: var(--accent);
        }

        /* Action Buttons */
        .contact-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .action-btn {
            display: inline-flex;
            gap: 8px;
            align-items: center;
            padding: 12px 16px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 77, 64, 0.3);
        }

        .action-btn i {
            font-size: 16px;
        }

        /* Close Button */
        .close-x {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            margin-left: 80%;
            background: rgba(10, 134, 41, 0.9);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: var(--primary);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .close-x:hover {
            transform: rotate(90deg) scale(1.1);
           background: rgba(26, 79, 39, 0.9);
        }

        /* Working Hours */
        .working-hours {
            font-size: 13px;
            color: var(--text-secondary);
            text-align: center;
            padding: 16px;
            background: rgba(0, 77, 64, 0.05);
            border-radius: 10px;
            margin-top: 20px;
        }

        /* Right Section - QR Code */
        .contact-right {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            color: white;
            text-align: center;
        }

        .qr-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .qr-title {
            font-weight: 800;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .qr-wrap {
            background: white;
            padding: 16px;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            animation: qrPulse 2s ease-in-out infinite;
        }

        @keyframes qrPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .qr-wrap canvas,
        .qr-wrap img {
            width: 160px;
            height: 160px;
            display: block;
            border-radius: 8px;
        }

        .qr-note {
            font-size: 12px;
            opacity: 0.9;
            line-height: 1.4;
            max-width: 280px;
        }

        /* Social Actions */
        .social-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .social-btn {
            display: inline-flex;
            gap: 6px;
            align-items: center;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .social-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 900px) {
            .contact-modal {
                grid-template-columns: 1fr;
                max-width: 450px;
            }

            .contact-right {
                order: -1;
                padding: 30px 25px;
            }

            .contact-left {
                padding: 30px 25px;
                min-height: auto;
            }

            .contact-floating {
                bottom: 20px;
                left: 20px;
                padding: 12px 16px;
            }

            .brand .logo {
                width: 56px;
                height: 56px;
                font-size: 20px;
            }

            .brand .info .title {
                font-size: 20px;
            }

            .qr-wrap canvas,
            .qr-wrap img {
                width: 140px;
                height: 140px;
            }
        }

        @media (max-width: 480px) {
            .contact-actions {
                flex-direction: column;
            }

            .action-btn {
                justify-content: center;
            }

            .social-actions {
                flex-direction: column;
                width: 100%;
            }

            .social-btn {
                justify-content: center;
            }
        }
   #suggestions{position:absolute;margin-left: 70%;  left: 0; right:0;top:100%;background:#fff;border-top:none;max-height:320px;max-width:30%; overflow:auto;z-index:50;border-radius:6px 6px 6px 6px}
.s-item{display:flex;gap:10px;padding:8px;align-items:center;cursor:pointer;border-bottom:1px solid #eee}
    .s-item img{width:54px;height:40px;object-fit:cover;border-radius:4px}
    .s-meta{flex:1;text-align:right}
    .s-name{font-weight:bold}
    * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
body {
  border: 5px solid #C9A349; 
  padding: 20px;
  background: #f6f3f1;
  box-sizing: border-box;
  margin: 0;
}

/* Logo Animation */
@keyframes logoEntrance {
  0% {
    opacity: 0;
    transform: scale(0.8) translateY(-20px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* Navbar */
.navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 2rem;
  background: #f6f3f1;
  
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
  border-top: 5px solid #C9A349; 
  border-right: 5px solid #C9A349;
   border-left: 5px solid #C9A349; 
   height: 80px;
}
.logo {
  font-size: 2.5rem;
  font-weight: bold;
  color: #1c2b6c;
  cursor: pointer;
  animation: logoEntrance 0.8s ease-out forwards;
  transition: transform 0.4s ease, color 0.3s ease;

}
.logo img {
  width: 150px;
  height: auto;
  transition: transform 0.7s ease;
}
.logo:hover img {
  transform: scale(1.1);
}
.logo:hover {
  transform: scale(1.1) rotate(-2deg);
  color: #b99b6b;
}
nav ul {
  list-style: none;
  display: flex;
  gap: 1.5rem;
}
nav a {
  text-decoration: none;
  color: #C9A349;
  position: relative;
  transition: color 0.3s ease;
  font-weight: bolder;
  font-family: 'Poppins', sans-serif;
  margin-left: 10px;
}
nav a::after {
  content: '';
  position: absolute;
  width: 0%;
  height: 2px;
  left: 0;
  bottom: -4px;
  background-color: #b99b6b;
  transition: width 0.3s ease;
}
nav a:hover {
  color: #b99b6b;
}
nav a:hover::after {
  width: 100%;
}
.nav-icons {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}
.nav-icons input {
  padding: 10px 25px;
  border: 3px solid #b99b6b;
  border-radius: 18px;
  transition: all 0.3s ease;
  width: 42vh;
  height: 40px;

}
.nav-icons input::placeholder {
  color: #b99b6b;
  font-weight: bold;
  font-family: 'Poppins', sans-serif;
}

.nav-icons input:focus {
  outline: none;
  border-color: #b99b6b;
  box-shadow: 0 0 5px rgba(185, 155, 107, 0.5);
}
.btn-connexion {
  background-color: #014537;
  color: #fff;
  border: none;
  padding: 0.6rem 1.1rem;
  border-radius: 15px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
.btn-connexion:hover {
  background-color: #a48858;
}

   .container {
      display: flex;
      flex-direction: row;
      gap: 40px;
      margin-top: 15vh;
      width: 100%;
      padding-left: 5%;
    }
    .left-column {
      width: 55%;
      position: relative; 
    }
    .right-column {
      width: 45%;
      padding-top: 25px;
    }
    .right-column h2 {
      font-size: 28px;
      margin-bottom: 10px;
      font-family: Arial, Helvetica, sans-serif;
      font-weight: bolder;
      margin-left: 50px;
    }
    .main-image {
      width: 100%;
      height: 500px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      transition: opacity 0.3s ease;
      opacity: 1;
    }
    .thumbnails {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }
    .thumbnails img {
       width: 80px;
      height: 60px;
      object-fit: cover;
      border: 2px solid transparent;
      cursor: pointer;
      border-radius: 5px;
      transition: transform 0.3s;
    }
    .thumbnails img:hover {
      transform: scale(1.05);
    }
    .thumbnails img.selected {
      border-color: #000;
    }
    .color-picker, .size-picker {
      margin-top: 20px;
    }
    .color-picker img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      cursor: pointer;
      border-radius: 15%;
      margin-right: 10px;
      border: 2px solid transparent;
      transition: transform 0.3s, border-color 0.3s;
    }
    .color-picker img:hover {
      transform: scale(1.05);
    }
    .color-picker img.selected {
      border-color: black;
    }
    .size-picker button {
      padding: 8px 16px;
      margin-right: 10px;
      background-color: white;
      border: 1px solid #000;
      border-radius: 20px;
      cursor: pointer;
    }
    .size-picker button.selected {
      background-color: black;
      color: white;
    }
    #prevArrow, #nextArrow {
      position: absolute;
      top: 22%;
      font-size: 30px;
      color: black;
      cursor: pointer;
      user-select: none;
      background-color: rgba(255, 255, 255, 0.7);
      padding: 5px 10px;
      border-radius: 50%;
      transition: background-color 0.3s ease;
      transform: translateY(-50%);
      z-index: 10;
    }
    #prevArrow:hover, #nextArrow:hover {
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
    }
    #prevArrow {
      left: 10px;
    }
    #nextArrow {
      right: 10px;
    }
    .nom-magasin {
      margin-top: 45px;
    }
    .nom-magasin span {
      font-size: 25px;
      color: #014537;
      font-family: Arial, Helvetica, sans-serif;
      font-weight: bolder;
    }
    .price {
      font-size: 25px;
      color: #014537;
      margin-bottom: 20px;
      font-family: Arial, Helvetica, sans-serif;
      font-weight: bolder;
      margin-top: 25px;
    }
    strong {
      margin-top: 15px;
      margin-bottom: 5px;
      font-family: 'Times New Roman', Times, serif;
      font-weight: bolder;
      color: #014537;
      font-size: 20px;
    }
    #selectedColorLabel, #selectedSizeLabel {
      font-weight: bold;
      color: black;
      font-size: 15px;
      font-family: Arial, Helvetica, sans-serif;
    }
    .actions {
      margin-top: 20px;
    }

    .actions span {
      font-size: 20px;
      color: #014537;
      font-family: Arial, Helvetica, sans-serif;
     
    }
    .actions p {
      font-size: 18px;
      color:black;
      font-family: Arial, Helvetica, sans-serif;
      margin-top: 20px;
      
      font-weight: bold;
    }
    .product-store-info {
  background-color: #fffefb;
  padding: 20px;
  border-left: 5px solid #D4AF37;
  font-family: 'Segoe UI', sans-serif;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  line-height: 1.6;
  margin-top: 30px;
}

.product-store-info h3 {
  color: #b6862b;
  margin-top: 10px;
}

.product-store-info p {
  margin: 6px 0;
  font-size: 15px;
  font-weight: bold;
}

.product-store-info a {
  color: #b6862b;
  text-decoration: none;
}

.product-store-info a:hover {
  text-decoration: underline;
}

  </style>
</head>
<body>
  <div class="overlay" id="contactOverlay" aria-hidden="true">
        <div class="contact-modal" role="dialog" aria-modal="true" id="contactDialog">
            <div class="contact-left">
                <button class="close-x" id="closeContact" aria-label="إغلاق النافذة">
                    <i class="fa-solid fa-xmark"></i>
                </button>

                <div>
                    <!-- Brand Section -->
                    <div class="brand">
                        <div class="logo"><img src="img/logo.png" alt=""></div>
                        <div class="info">
                            <div class="title">Vira Decoration</div>
                            <div class="subtitle"></div>
                        </div>
                    </div>

                    <!-- Contact List -->
                    <div class="contact-list">
                        <div class="contact-item">
                            <i class="fa-solid fa-phone"></i>
                            <div class="meta">
                                <div class="label">Tel</div>
                                <div class="value">
                                    <a href="tel:+966501234567">+212 6 02 15 66 53</a>
                                </div>
                            </div>
                        </div>

                        <div class="contact-item">
                            <i class="fa-solid fa-envelope"></i>
                            <div class="meta">
                                <div class="label">Email</div>
                                <div class="value">
                                    <a href="mailto:Vira-Decoration@gmail.com">Vira-Decoration@gmail.com</a>
                                </div>
                            </div>
                        </div>

                        <div class="contact-item">
                            <i class="fa-solid fa-location-dot"></i>
                            <div class="meta">
                                <div class="label">Address</div>
                                <div class="value"></div>
                            </div>
                        </div>

                        <div class="contact-item">
                            <i class="fa-brands fa-whatsapp"></i>
                            <div class="meta">
                                <div class="label">Whatsapp</div>
                                <div class="value">
                                    <a href="https://wa.me/212602156653">+212602156653</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="contact-actions">
                        <a class="action-btn" href="https://wa.me/212602156653" target="_blank">
                            <i class="fa-brands fa-whatsapp"></i>Whatsapp
                        </a>
                        <a class="action-btn" href="tel:+212602156653">
                            <i class="fa-solid fa-phone"></i>Contactez-nous
                        </a>
                        <a class="action-btn" href="Vira-Decoration@gmail.com">
                            <i class="fa-solid fa-envelope"></i>Envoyer un email
                        </a>
                    </div>
                </div>

                <!-- Working Hours -->
                <div class="working-hours">
                    <i class="fa-solid fa-clock"></i>
                     Horaires d'ouverture : Lundi - samedi :  (9h00 - 19h00)
                </div>
                <div class="plateforme">
                <span>notre plateforme<button id="toggleBtn">+</button></span>
                 <p id="message" style="display: none;color: #014537;">
Notre plateforme est un espace en ligne qui regroupe et présente les dernières tendances et décorations disponibles dans les magasins de différentes villes marocaines, afin de faciliter la recherche et l’achat aussi bien pour les clients que pour les architectes d’intérieur.
Nous ne vendons pas les produits : nous affichons uniquement ce qui est disponible en magasin, avec des informations utiles telles que la possibilité de livraison, les coordonnées et la localisation du magasin.
Toutes les ventes et livraisons sont gérées directement par les magasins. Pour toute question ou problème lié au service ou à la livraison, veuillez contacter directement le magasin concerné.
Si vous vous rendez dans un magasin et ne trouvez pas l’article recherché ou constatez une différence de prix, nous vous invitons à nous en informer afin de préserver la crédibilité et d’améliorer continuellement notre service.</p>
                </div>

            </div>

            <!-- QR Code Section -->
            <div class="contact-right">
                <div class="qr-section">
                    <div class="qr-title">
                        <i class="fa-solid fa-qrcode"></i>Scannez pour une communication rapide
                    </div>
                    <div class="qr-wrap" id="qrWrap">
                        <canvas id="qrCanvas"></canvas>
                    </div>
                    <div class="qr-note">Scannez le code pour accéder directement  à notre Whatsapp 
                    </div>
                </div>

                <div class="social-actions">
                    <a class="social-btn" href="https://instagram.com/nelitedesign" target="_blank">
                        <i class="fa-brands fa-instagram"></i> Instagram
                    </a>
                    <button class="social-btn" id="copyPhone">
                        <i class="fa-solid fa-copy"></i> Copier le numéro de téléphone
                    </button>
                </div>
            </div>
        </div>
    </div>
 <header class="navbar">
    <div class="logo"><img src="/uploads/logo.png" alt=""></div>
    <nav>
      <ul>
        <li><a href="/index.html">HOME</a></li>
        <li><a href="/index2.html">MEUBLES</a></li>
        <li><a href="/index3.html">DÉCORATION</a></li>
        <li><a href="/index4.html">MAGASINS</a></li>
        <li id="openContact"><a href="#">CONTACT</a></li>
        <li><a href="/login" class="btn btn-secondary">CONNEXION</a></li>
      </ul>
    </nav>
    <div class="nav-icons">
      <input id="search-input" type="text" placeholder="Chercher..." />
      <div id="suggestions"></div>
      <button id="btn-search" class="btn-connexion">Connexion</button>
    </div>
  </header>
  <div class="container">
    <div class="left-column">
      <img id="mainImage" class="main-image" src="<%= arr.mainImages[0] %>" alt="Image principale" />
      <span id="prevArrow">&#10094;</span>
      <span id="nextArrow">&#10095;</span>
      <div class="thumbnails" id="thumbnails"></div>
      <div class="product-store-info">
  <h3> Produit : <%= arr.name %></h3>
  <p><strong>Description :</strong> <%= arr.description %></p>
  <p><strong>Prix :</strong> <%= arr.price %> MAD</p>

  <hr style="margin: 15px 0;">

  <h3> Magasin : <%= user.storeName %></h3>
  <p><strong>Adresse :</strong> <%= user.storeAddress %>, <%= user.storeLocation %></p>
  <p><strong>Téléphone :</strong> <%= user.phone %></p>
  <p><strong>WhatsApp :</strong> <a href="https://wa.me/<%= user.phone %>" target="_blank">Envoyer un message</a></p>
</div>
    </div>

    <div class="right-column">
      <h2><%= arr.name %></h2>
      <h1 class="nom-magasin"><span> Magasin:</span> <%= user.storeName %>, <%= user.storeLocation %></h1>
      <p class="price">À partir de <%= arr.price %> DH</p>
      <p><strong>Couleur:</strong> <span id="selectedColorLabel"><%= arr.color %></span></p>
     <!-- في جزء color-picker من الصفحة -->
<div class="color-picker">
    <img src="<%= arr.mainImages[0] %>" 
         onclick="selectColor('<%= arr.color %>')" 
         class="selected" 
         alt="<%= arr.color %>" />
    
    <% if (arr.additionalColors && arr.additionalColors.length > 0) { %>
        <% arr.additionalColors.forEach(color => { %>
            <% if (color.images && color.images.length > 0) { %>
                <img src="<%= color.images[0] %>" 
                     onclick="selectColor('<%= color.color %>')" 
                     alt="<%= color.color %>" 
                     onerror="this.style.display='none'" />
            <% } %>
        <% }) %>
    <% } %>
</div>

      <p style="margin-top: 2vh;"><strong>Taille:</strong> <span id="selectedSizeLabel"><%= arr.name %> <%= arr.size %></span></p>
      <div class="actions">
        <p><span>Livraison</span>:<% if (user.deliveryArea === 'toute_maroc') { %>
         Livraison dans tout le Maroc
    <% } else if (user.deliveryArea === 'region_seule') { %>
        Livraison uniquement dans la région
    <% } else if (user.deliveryArea === 'ville_seule') { %>
        Livraison uniquement dans la ville
    <% } else { %>
         Non spécifié
    <% } %></p></h1>
       
    </div>
    </div>
  </div>
  <script>
      const toggleBtn = document.getElementById("toggleBtn");
const message = document.getElementById("message");

toggleBtn.addEventListener("click", () => {
  if (message.style.display === "none") {
    message.style.display = "block";
    toggleBtn.textContent = "−"; // من + إلى −
  } else {
    message.style.display = "none";
    toggleBtn.textContent = "+"; // من − إلى +
  }
});
        (function() {
            const openBtn = document.getElementById('openContact');
            const overlay = document.getElementById('contactOverlay');
            const modal = document.getElementById('contactDialog');
            const closeBtn = document.getElementById('closeContact');
            const qrCanvas = document.getElementById('qrCanvas');
            const copyPhone = document.getElementById('copyPhone');

            // الرابط الذي سيتم توليد QR له
            const message = "Bonjour, je souhaiterais vous parler d'un problème que j'ai rencontré ou vous apporter un retour d'expérience pour le développement de la plateforme.";
            const encodedMessage = encodeURIComponent(message);
            const QR_TARGET = `https://wa.me/212602156653?text=${encodedMessage}`;


            let lastFocused = null;

            // توليد QR Code
            function generateQR() {
                if (window.QRCode && qrCanvas) {
                    QRCode.toCanvas(qrCanvas, QR_TARGET, {
                        width: 160,
                        height: 160,
                        margin: 2,
                        color: {
                            dark: '#004d40',
                            light: '#ffffff'
                        }
                    }, function(error) {
                        if (error) {
                            console.error('QR generation error:', error);
                            // Fallback to API
                            const img = document.createElement('img');
                            img.src = "https://api.qrserver.com/v1/create-qr-code/?size=160x160&color=004d40&bgcolor=ffffff&data=" + encodeURIComponent(QR_TARGET);
                            img.style.width = '160px';
                            img.style.height = '160px';
                            img.style.borderRadius = '8px';
                            const wrap = document.getElementById('qrWrap');
                            wrap.replaceChild(img, qrCanvas);
                        }
                    });
                } else {
                    // Fallback to API
                    const img = document.createElement('img');
                    img.src = "https://api.qrserver.com/v1/create-qr-code/?size=160x160&color=004d40&bgcolor=ffffff&data=" + encodeURIComponent(QR_TARGET);
                    img.style.width = '160px';
                    img.style.height = '160px';
                    img.style.borderRadius = '8px';
                    const wrap = document.getElementById('qrWrap');
                    wrap.replaceChild(img, qrCanvas);
                }
            }

            // Focus trap للوصولية
            function trapFocus(e) {
                const focusable = modal.querySelectorAll('a, button, input, textarea, [tabindex]:not([tabindex="-1"])');
                if (!focusable.length) return;
                
                const first = focusable[0];
                const last = focusable[focusable.length - 1];
                
                if (e.key === 'Tab') {
                    if (e.shiftKey && document.activeElement === first) {
                        e.preventDefault();
                        last.focus();
                    } else if (!e.shiftKey && document.activeElement === last) {
                        e.preventDefault();
                        first.focus();
                    }
                }
                
                if (e.key === 'Escape') {
                    closeModal();
                }
            }

            // فتح النافذة
            function openModal() {
                lastFocused = document.activeElement;
                overlay.classList.add('show');
                overlay.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';
                generateQR();
                
                setTimeout(() => {
                    const firstBtn = modal.querySelector('a, button, [tabindex]:not([tabindex="-1"])');
                    if (firstBtn) firstBtn.focus();
                    document.addEventListener('keydown', trapFocus);
                }, 100);
            }

            // إغلاق النافذة
            function closeModal() {
                overlay.classList.remove('show');
                overlay.setAttribute('aria-hidden', 'true');
                document.body.style.overflow = '';
                document.removeEventListener('keydown', trapFocus);
                if (lastFocused) lastFocused.focus();
            }

            // Event listeners
            openBtn.addEventListener('click', openModal);
            closeBtn.addEventListener('click', closeModal);

            // إغلاق عند النقر خارج النافذة
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) closeModal();
            });

            // نسخ رقم الهاتف
            copyPhone.addEventListener('click', function(e) {
                e.preventDefault();
                const phone = "+212602156653";
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(phone).then(() => {
                        copyPhone.innerHTML = '<i class="fa-solid fa-check"></i> Copié avec succès';
                        setTimeout(() => {
                            copyPhone.innerHTML = '<i class="fa-solid fa-copy"></i> Copier le numéro de téléphone';
                        }, 2000);
                    }).catch(() => {
                        alert('فشل النسخ، انسخ الرقم يدوياً: ' + phone);
                    });
                } else {
                    // Fallback للمتصفحات القديمة
                    const textArea = document.createElement('textarea');
                    textArea.value = phone;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        copyPhone.innerHTML = '<i class="fa-solid fa-check"></i> Copié avec succès ';
                        setTimeout(() => {
                            copyPhone.innerHTML = '<i class="fa-solid fa-copy"></i> Copier le numéro de téléphone ';
                        }, 2000);
                    } catch (err) {
                        alert('La copie a échoué, copiez le numéro manuellement : ' + phone);
                    }
                    document.body.removeChild(textArea);
                }
            });

        })();
    </script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script>
    let products = [];
const input = document.getElementById('search-input');
const suggestions = document.getElementById('suggestions');
const btnSearch = document.getElementById('btn-search');

let searchTimeout;

async function loadProducts() {
  try {
    const response = await fetch('/api/products');
    if (!response.ok) throw new Error('Network response was not ok');
    
    products = await response.json();
    
    window.fuseIndex = new Fuse(products, {
      keys: [
        'name', 
        'city', 
        'style', 
        'color', 
        'category', 
        'bigcategory', 
        'smallcategory', 
        'vendeur'
      ],
      threshold: 0.45,
      includeScore: true
    });
    
    //('Products loaded successfully:', products.length);
  } catch (err) {
    console.error('فشل تحميل المنتجات', err);
    suggestions.innerHTML = '<div style="padding:10px;color:#f00">خطأ في تحميل البيانات</div>';
  }
}

async function searchFromServer(query) {
  try {
    const response = await fetch(`/api/products/search?q=${encodeURIComponent(query)}`);
    if (!response.ok) throw new Error('Network response was not ok');
    
    const results = await response.json();
    
    const formattedResults = results.map(item => ({
      item: item,
      score: 0
    }));
    
    renderSuggestions(formattedResults);
  } catch (error) {
    console.error('Search error:', error);
    renderSuggestions([]);
  }
}

function renderSuggestions(results) {
  if (!results || results.length === 0) {
    suggestions.innerHTML = '<div style="padding:10px;color:#666">aucun résultat</div>';
    return;
  }
  
  suggestions.innerHTML = results.slice(0, 8).map(r => {
    const item = r.item;
    
    const displayCategory = item.bigcategory || item.category || '';
    
    return `
      <div class="s-item" data-id="${item._id}" data-name="${encodeURIComponent(item.name)}" data-city="${item.city || ''}" data-category="${item.category || ''}">
        ${item.mainImages[0] ? `<img src="${item.mainImages[0]}" alt="${item.name}" onerror="this.style.display='none'">` : ''}
        <div class="s-meta">
          <div class="s-name">${item.name}</div>
          <div class="s-price" style="font-size:13px;color:#004d40;font-weight:bold;margin-bottom:2px">
            ${item.price ? `${item.price}` : ''}
          </div>
          <div style="font-size:12px;color:#666">
            ${item.city || '' }
          </div>
        </div>
      </div>
    `;
  }).join('');
  
  // إضافة event listeners للاقتراحات
  document.querySelectorAll('.s-item').forEach(el => {
    el.addEventListener('click', () => {
      const productId = el.dataset.id;
      const productName = decodeURIComponent(el.dataset.name);
      const productCity = el.dataset.city;
      const productCategory = el.dataset.category;
      
      // الانتقال إلى صفحة البحث مع المنتج المحدد
      // نحتاج إلى إرسال POST request مع البيانات
      sendToSearchPage({
        query: productName,
        selectedProductId: productId,
        productName: productName,
        productCity: productCity,
        productCategory: productCategory
      });
    });
  });
}

// دالة لإرسال البيانات إلى صفحة البحث
function sendToSearchPage(data) {
  // إنشاء form مخفي
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = '/search';  // هذا هو route الـ search.ejs
  
  // إضافة حقول مخفية للبيانات
  Object.keys(data).forEach(key => {
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = key;
    input.value = data[key];
    form.appendChild(input);
  });
  
  // إضافة form إلى الصفحة وإرساله
  document.body.appendChild(form);
  form.submit();
}

// استراتيجية البحث الهجينة
input.addEventListener('input', () => {
  const q = input.value.trim();
  
  if (searchTimeout) clearTimeout(searchTimeout);
  
  if (!q) {
    suggestions.innerHTML = '';
    return;
  }
  
  if (window.fuseIndex && products.length > 0) {
    const res = window.fuseIndex.search(q, { limit: 12 });
    renderSuggestions(res);
  } else {
    searchTimeout = setTimeout(() => {
      searchFromServer(q);
    }, 300);
  }
});

// زر البحث
btnSearch.addEventListener('click', () => {
  const q = input.value.trim();
  if (!q) {
    alert('يرجى إدخال كلمة للبحث.');
    input.focus();
    return;
  }
  
  // عند الضغط على زر "Connexion"، ننتقل إلى صفحة البحث مع query فقط
  sendToSearchPage({
    query: q,
    selectedProductId: ''
  });
});

// إخفاء الاقتراحات عند النقر خارجها
document.addEventListener('click', (e) => {
  if (!e.target.closest('.nav-icons')) suggestions.innerHTML = '';
});

// دعم الضغط Enter
input.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    btnSearch.click();
  }
});

// تحميل المنتجات عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', () => {
  loadProducts();
});
  </script>
  <script>
    // Scroll effect for navbar
window.addEventListener("scroll", () => {
  if (window.scrollY > 10) {
    document.body.classList.add("scrolled");
  } else {
    document.body.classList.remove("scrolled");
  }
});

  </script>
<script>
    let productData = null;
    let images = {};
    let selectedColor = '';
    let selectedSize = '';
    let currentIndex = 0;

    const mainImage = document.getElementById('mainImage');
    const thumbnails = document.getElementById('thumbnails');
    const prevArrow = document.getElementById('prevArrow');
    const nextArrow = document.getElementById('nextArrow');

    // جلب بيانات المنتج من قاعدة البيانات
    async function loadProductData() {
        try {
            const productId = '<%= arr._id %>';
            const response = await fetch(`/api/product/${productId}`);
            if (!response.ok) throw new Error('Failed to load product data');
            
            productData = await response.json();
            
            // بناء كائن images ديناميكياً
            images = {};
            
            // اللون الرئيسي
            if (productData.color && productData.mainImages && productData.mainImages.length > 0) {
                images[productData.color] = {
                    [productData.name]: productData.mainImages
                };
            }
            
            // الألوان الإضافية
            if (productData.additionalColors && productData.additionalColors.length > 0) {
                productData.additionalColors.forEach(color => {
                    if (!images[color.color]) {
                        images[color.color] = {};
                    }
                    images[color.color][productData.name] = color.images || [];
                });
            }
            
            // تعيين القيم الافتراضية
            selectedColor = productData.color || Object.keys(images)[0] || '';
            selectedSize = productData.name || (Object.keys(images[selectedColor] || {})[0]) || '';
            
            updateGallery();
            
        } catch (error) {
            console.error('❌ Erreur chargement produit:', error);
        }
    }

    function updateGallery() {
        if (!images[selectedColor] || !images[selectedColor][selectedSize]) {
            console.error('Images non trouvées');
            return;
        }
        
        const currentImages = images[selectedColor][selectedSize];
        
        if (!currentImages || currentImages.length === 0) {
            console.error('Aucune image disponible');
            return;
        }
        
        currentIndex = 0;

        // تحديث الصورة الرئيسية
        mainImage.style.opacity = 0;
        setTimeout(() => {
            mainImage.src = currentImages[currentIndex];
            mainImage.style.opacity = 1;
        }, 300);

        // تحديث الصور المصغرة
        thumbnails.innerHTML = '';
        currentImages.forEach((imgSrc, index) => {
            const thumb = document.createElement('img');
            thumb.src = imgSrc;
            thumb.classList.add('thumbnail');
            if (index === 0) thumb.classList.add('selected');
            thumb.onclick = () => {
                currentIndex = index;
                updateMainImage();
                updateSelectedThumbnail();
            };
            thumbnails.appendChild(thumb);
        });

        // تحديث النصوص
        document.getElementById('selectedColorLabel').innerText = selectedColor;
        document.getElementById('selectedSizeLabel').innerText = selectedSize;

        // تحديث تحديد اللون
        const colorImages = document.querySelectorAll('.color-picker img');
        colorImages.forEach(img => img.classList.remove('selected'));
        const selectedImg = [...colorImages].find(img => img.alt === selectedColor);
        if (selectedImg) selectedImg.classList.add('selected');
    }

    function updateMainImage() {
        const currentImages = images[selectedColor][selectedSize];
        mainImage.style.opacity = 0;
        setTimeout(() => {
            mainImage.src = currentImages[currentIndex];
            mainImage.style.opacity = 1;
        }, 300);
    }

    function updateSelectedThumbnail() {
        const thumbs = thumbnails.querySelectorAll('img');
        thumbs.forEach(t => t.classList.remove('selected'));
        if(thumbs[currentIndex]) thumbs[currentIndex].classList.add('selected');
    }

    function selectColor(color) {
        selectedColor = color;
        if (images[selectedColor] && images[selectedColor][selectedSize]) {
            updateGallery();
        } else {
            // استخدام أول حجم متاح
            const firstAvailableSize = Object.keys(images[selectedColor] || {})[0];
            if (firstAvailableSize) {
                selectedSize = firstAvailableSize;
                updateGallery();
            }
        }
    }

    function selectSize(size) {
        selectedSize = size;
        if (images[selectedColor] && images[selectedColor][selectedSize]) {
            updateGallery();
        }
    }

    prevArrow.addEventListener('click', () => {
        const currentImages = images[selectedColor][selectedSize];
        if (currentImages && currentImages.length > 0) {
            currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
            updateMainImage();
            updateSelectedThumbnail();
        }
    });

    nextArrow.addEventListener('click', () => {
        const currentImages = images[selectedColor][selectedSize];
        if (currentImages && currentImages.length > 0) {
            currentIndex = (currentIndex + 1) % currentImages.length;
            updateMainImage();
            updateSelectedThumbnail();
        }
    });

    // تحميل البيانات عند بدء التشغيل
    document.addEventListener('DOMContentLoaded', () => {
        loadProductData();
        loadProducts(); // دالة البحث الموجودة
    });

  </script>
</body>
</html>